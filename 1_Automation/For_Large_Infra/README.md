
# AWS EC2 Instances Grouped by AMI: Python Script

## Overview

This project contains a Python script designed to gather information about all EC2 instances in an AWS account, grouped by the Amazon Machine Image (AMI) IDs they are using. It retrieves detailed information about the AMIs, organizes the data into a structured format, and outputs the results as a JSON file.

This script is efficient, concise, and secure, offering a practical solution for AWS administrators and engineers who need to audit or manage EC2 resources effectively.

---

## Key Features

### **Core Functionality**
- **Instance Grouping by AMI**: Collects all EC2 instances and groups them by the AMI IDs they use.  
- **AMI Information**: Retrieves detailed information about each AMI:
  - **Image Description**: A description of the AMI.
  - **Image Name**: The name of the AMI.
  - **Image Location**: The storage location of the AMI.
  - **Owner ID**: The account ID of the AMI owner.

### **Error Handling**
- Gracefully handles deregistered or unavailable AMIs by returning `null` for missing information.

### **Output**
- The script outputs a JSON file (`ami_output.json`) that groups EC2 instances by their AMI IDs, making it easy to read and use for further processing.

### **Security**
- The script uses AWS CLI for secure credential management and ensures minimal exposure of sensitive AWS data by making targeted API calls.

---

## Prerequisites

To run the script, you need the following:

1. **AWS CLI**: Installed and configured with valid AWS credentials. You can set up the CLI by following the [AWS CLI Configuration Guide](https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html).
2. **Python 3.x**: The script is written in Python, so ensure that Python 3.x is installed on your system.
3. **Boto3 Library**: The Python script uses the `boto3` library to interact with AWS. Install it via `pip`:
   ```bash
   pip install boto3
   ```

4. **Permissions**: The script requires the following AWS permissions:
   - `ec2:DescribeInstances`
   - `ec2:DescribeImages`

---

## How It Works

### **Script Breakdown**
1. **Retrieve EC2 Instances**  
   The script uses the `boto3` library to query EC2 instances in the current AWS region:
   ```python
   ec2.describe_instances()
   ```
   It collects instance IDs and their corresponding AMI IDs.

2. **Group Instances by AMI**  
   For each unique AMI ID, the script groups the EC2 instances that are using it.

3. **Fetch AMI Details**  
   For each unique AMI ID, the script fetches additional details like the description, name, location, and owner ID:
   ```python
   ec2.describe_images(ImagesIds=[ami_id])
   ```

4. **Handle Missing AMIs**  
   If an AMI is deregistered or unavailable, the script assigns `null` values to the respective fields.

5. **Output Results**  
   The data is saved as a JSON file (`ami_output.json`), formatted for easy use in other tools or reports.

---

## How to Use

1. **Run the Script**  
   Execute the Python script in your terminal:
   ```bash
   python3 Ami_details_Python.py
   ```

2. **View the Output**  
   The output is saved in `ami_output.json`. Open it with a text editor or JSON viewer:
   ```bash
   cat ami_output.json
   ```

3. **Optional: Change AWS Profile**  
   If you have multiple AWS profiles, set the `AWS_PROFILE` environment variable:
   ```bash
   export AWS_PROFILE=my-profile
   ```

---

## Example Output

Here is an example of the JSON output generated by the script:

```json
{
  "ami-0d5f069b7a75be450": {
    "ImageDescription": "ubuntu-1804-encrypted-amd64-20190403",
    "ImageName": "ubuntu-1804-encrypted-amd64-20190403",
    "ImageLocation": "12345678901/ubuntu-1804-encrypted-amd64-20190403",
    "OwnerId": "12345678901",
    "InstanceIds": [
      "i-04f241953cfe0066d",
      "i-02439968b22cb6b8d"
    ]
  },
  "ami-1df0ac78": {
    "ImageDescription": null,
    "ImageName": null,
    "ImageLocation": null,
    "OwnerId": null,
    "InstanceIds": [
      "i-19be2ba7",
      "i-6a7a49dd"
    ]
  }
}
```

---

## Security Considerations

- The script retrieves only the necessary information to minimize API calls and reduce unnecessary exposure of sensitive account details.
- AWS credentials are managed securely using the AWS CLI profile.
- Ensure that IAM roles used to execute the script follow the principle of least privilege.

---

## Customization

- **Region**: By default, the script queries the AWS region set in your AWS CLI configuration. To use a different region, you can set the `AWS_DEFAULT_REGION` environment variable:
  ```bash
  export AWS_DEFAULT_REGION=us-west-1
  ```

- **Output File**: You can change the output file name by modifying the `OUTPUT_FILE` variable in the script.

